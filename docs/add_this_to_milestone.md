# MVP Milestone: 게임 UI 탐지 엔진 v1.0 (YOLO + OCR)

**최종 수정**: 2025-11-14
**버전**: v2.0 (MVP 전략 반영)

---

## 1. 🎯 목표 (Objective)

### 핵심 문제
게임 해상도, 화면 비율, UI 설정 변경 시 기존 OCR의 정적 BBOX(좌표) 방식이 실패하는 문제

### MVP 솔루션
동적으로 변화하는 화면 환경에서도 핵심 UI 요소(예: 일일 임무 HUD, 재화 카운터)의 위치를 **튼튼하게(Robust)** 탐지하고, 그 안의 텍스트를 정확히 인식하는 프로토타입 시스템 구축

### 성공 기준
- [ ] 3개 이상의 주요 해상도에서 95% 이상 UI 탐지 성공률
- [ ] 재화/콘텐츠 정보 OCR 정확도 90% 이상
- [ ] 실시간 처리 가능 (프레임당 100ms 이내)

## 2. 🏛️ 핵심 아키텍처 (Chosen Architecture)

VLM(Vision Language Model)의 높은 비용(무게, 속도)을 고려하여, **'객체 탐지(Object Detection) + OCR' 하이브리드 방식**을 최종 채택한다.

1.  **[Task 1: 탐지] 객체 탐지 모델 (YOLO 등)**
    * **역할:** 전체 스크린샷에서 '퀘스트 HUD', '미니맵' 등 우리가 찾는 UI 요소의 **BBOX 좌표를 동적으로 찾아낸다.**
    * **강점:** UI의 '생김새(패턴)'를 학습하므로, 화면 비율이 바뀌어 UI가 '재배치(Re-anchor)'되어도 정확히 추적한다.

2.  **[Task 2: 인식] OCR 엔진 (Tesseract, EasyOCR 등)**
    * **역할:** Task 1에서 찾아낸 **BBOX 영역의 이미지**만 입력받아, 그 안의 텍스트(예: "일일 임무 (5/10)")를 추출한다.
    * **강점:** 이미 검증된 고성능 OCR 엔진을 활용하여, 인식률을 극대화하고 텍스트 인식 모델을 별도로 학습시키는 비용을 절감한다.

---

## 3. 💾 데이터 전략 (Data Strategy)

모델의 성능은 데이터의 품질로 직결되므로, '최소한의 노력으로 최대의 다양성'을 확보하는 것을 목표로 한다.

### 3-1. 원천 데이터 (Source)

* 보유 중인 약 1개월 분량의 게임 플레이 녹화 영상 (단일 해상도: `2560x1600`)

### 3-2. 라벨링 계획 (Labeling Plan)

* **도구:** `Label Studio` 활용
* **방식:** 개별 프레임이 아닌, **'비디오 타임라인'**에 직접 라벨링.
    * 예: `[01:30 ~ 01:35]` 구간에 `[quest_hud_bbox]`가 나타남.
* **라벨 스키마:** `[BBOX 좌표]` + `[UI 태그]` (예: `quest_hud_daily`, `quest_hud_complete`)
    * **중요:** OD 모델 학습이 목적이므로, BBOX 안의 '텍스트 내용'은 라벨링하지 않는다. (이는 Task 2 OCR의 몫)

### 3-3. 데이터 추출 (Smart Sampling)

단순히 초당 1프레임씩 추출하는 방식은 '잠수' 구간의 과적합(Overfitting)을 유발한다. **'장면 변화 감지(Scene Change Detection)'** 기반의 스마트 샘플링을 도입한다.

* **로직:** SSIM(Structural Similarity Index) 등 이미지 유사도 측정
* **기준 1: (Idle 감지)** 이전 프레임과 유사도(SSIM)가 매우 높으면 (예: `> 0.98`) "변화 없는 잠수 구간"으로 판단하여 **프레임을 버린다.**
* **기준 2: (Action 감지)** 이전 프레임과 유사도가 낮으면 (예: `< 0.85`) "UI가 팝업되거나 배경이 급변하는 유의미한 구간"으로 판단하여 **프레임을 저장한다.**

### 3-4. 데이터 품질 확보 (Robustness)

`2560x1600` 단일 해상도 데이터만으로는 다양한 화면 비율/해상도에 대응하는 '튼튼한' 모델을 만들 수 없다.

* **기본:** 'Padding', 'Cropping' 등 데이터 증강(Augmentation)을 활용.
* **핵심 (고품질 전략):** 약간의 수작업을 동반하더라도, **가장 현실적인(Realistic) 데이터를 확보**한다.
    * **액션:** 다양한 주요 해상도 및 화면 비율(예: `1920x1080 (16:9)`, `3440x1440 (21:9)`)로 게임 설정을 변경하며 **추가 플레이 영상을 직접 녹화**한다.
    * **이유:** 인위적인 증강(찌그러짐)보다, 게임 엔진이 UI를 '재배치'한 실제 화면을 학습하는 것이 모델 성능에 직결된다.

## 4. 🚀 구현 로드맵 (Implementation Roadmap)

### Phase 1: 데이터 준비 (1-2주)

#### 1.1 게임별 데이터셋 스키마 정의
- **작업**: `feature/dataset-schema`
- **산출물**:
  - `schemas/game_resources.json` - 재화 정의 (골드, 크리스탈, 스태미나 등)
  - `schemas/game_contents.json` - 콘텐츠 정의 (던전, 레이드, 퀘스트 등)
  - `schemas/ui_elements.json` - UI 요소 정의 (HUD, 메뉴, 팝업 등)
- **체크리스트**:
  - [ ] 3개 게임 이상 데이터셋 스키마 작성
  - [ ] 재화 항목 10개 이상 정의
  - [ ] UI 요소 20개 이상 정의

#### 1.2 비디오 데이터 수집
- **작업**: `feature/video-recording`
- **산출물**:
  - 해상도별 플레이 영상 (최소 3개 해상도)
    - `1920x1080 (16:9)` - 30분 이상
    - `2560x1600 (16:10)` - 30분 이상
    - `3440x1440 (21:9)` - 30분 이상
- **체크리스트**:
  - [ ] 각 해상도별 다양한 UI 상태 녹화
  - [ ] 전투, 메뉴, 인벤토리 등 다양한 씬 포함
  - [ ] 영상 메타데이터 기록 (해상도, FPS, 게임 설정)

#### 1.3 스마트 샘플링 시스템 개발
- **작업**: `feature/video-sampling`
- **산출물**:
  - `tools/video_sampler.py` - SSIM 기반 프레임 추출
  - `tools/scene_detector.py` - 장면 전환 감지
- **알고리즘**:
  ```python
  # SSIM 기반 스마트 샘플링
  - SSIM > 0.98 → Skip (잠수 구간)
  - SSIM < 0.85 → Save (유의미한 변화)
  - 0.85 ≤ SSIM ≤ 0.98 → Interval sampling (5초마다)
  ```
- **체크리스트**:
  - [ ] SSIM 임계값 튜닝 완료
  - [ ] 30분 영상에서 300-500 프레임 추출 검증
  - [ ] 중복 프레임 제거 확인

### Phase 2: 라벨링 시스템 구축 (1주)

#### 2.1 Label Studio 환경 설정
- **작업**: `feature/label-studio-setup`
- **산출물**:
  - `docker-compose.label-studio.yml`
  - `label-studio/config.xml` - 라벨링 템플릿
- **라벨링 스키마**:
  ```xml
  <RectangleLabels name="bbox" toName="image">
    <Label value="quest_hud_daily" />
    <Label value="quest_hud_complete" />
    <Label value="resource_gold" />
    <Label value="resource_crystal" />
    <Label value="menu_main" />
  </RectangleLabels>
  ```
- **체크리스트**:
  - [ ] Label Studio 로컬 서버 구동
  - [ ] 프로젝트 생성 및 템플릿 설정
  - [ ] 첫 10개 이미지 테스트 라벨링

#### 2.2 라벨링 작업
- **작업**: `feature/labeling-pipeline`
- **목표 데이터셋 크기**:
  - 훈련 데이터: 1,000+ 이미지
  - 검증 데이터: 200+ 이미지
  - 테스트 데이터: 100+ 이미지
- **라벨링 전략**:
  - 비디오 타임라인 기반 일괄 라벨링
  - `[01:30 ~ 01:35]` 구간에 동일 라벨 적용
- **체크리스트**:
  - [ ] 1,000개 이상 BBOX 라벨링 완료
  - [ ] 클래스별 균형 확인 (각 클래스 최소 50개)
  - [ ] 라벨 품질 검증 (샘플링 체크)

### Phase 3: YOLO 모델 학습 (1-2주)

#### 3.1 학습 환경 구축
- **작업**: `feature/yolo-training-pipeline`
- **산출물**:
  - `training/train.py` - YOLOv8 학습 스크립트
  - `training/data.yaml` - 데이터셋 설정
  - `training/config.yaml` - 하이퍼파라미터 설정
- **하드웨어 요구사항**:
  - GPU: NVIDIA GTX 1060 이상 (6GB+ VRAM)
  - RAM: 16GB 이상
  - 디스크: 50GB+ 여유 공간
- **체크리스트**:
  - [ ] YOLOv8 설치 및 환경 구성
  - [ ] 데이터셋 YOLO 형식 변환
  - [ ] 학습/검증 데이터 분리 (80/20)

#### 3.2 모델 학습
- **작업**: `feature/model-training`
- **학습 계획**:
  ```python
  # 1차 학습: 베이스라인
  - Model: YOLOv8n (nano)
  - Epochs: 100
  - Batch size: 16
  - Image size: 640

  # 2차 학습: 성능 개선
  - Model: YOLOv8s (small)
  - Epochs: 200
  - Data augmentation 강화
  ```
- **체크리스트**:
  - [ ] 1차 학습 완료 (mAP@0.5 > 0.8)
  - [ ] 과적합 방지 (validation loss 모니터링)
  - [ ] 학습 로그 및 체크포인트 저장

#### 3.3 모델 평가
- **작업**: `feature/model-evaluation`
- **평가 지표**:
  - mAP@0.5 (Mean Average Precision)
  - Precision / Recall
  - Inference time (FPS)
- **테스트 시나리오**:
  - [ ] 훈련에 사용되지 않은 해상도 테스트
  - [ ] 다양한 밝기/대비 조건 테스트
  - [ ] 실시간 게임플레이 테스트
- **체크리스트**:
  - [ ] 테스트 데이터셋에서 mAP > 0.85
  - [ ] 오탐지율(False Positive) < 5%
  - [ ] 실시간 처리 속도 확인 (30 FPS 이상)

### Phase 4: OCR 통합 및 시스템 완성 (1주)

#### 4.1 OCR 엔진 선정 및 통합
- **작업**: `feature/ocr-integration`
- **후보 OCR 엔진**:
  - Tesseract (오픈소스, 무료)
  - EasyOCR (딥러닝 기반, 높은 정확도)
  - PaddleOCR (중국어/한국어 강점)
- **통합 방식**:
  ```python
  # YOLO → OCR 파이프라인
  1. YOLO로 UI 요소 BBOX 탐지
  2. BBOX 영역 이미지 크롭
  3. 전처리 (그레이스케일, 이진화)
  4. OCR 엔진으로 텍스트 추출
  5. 후처리 (정규표현식, 숫자 파싱)
  ```
- **체크리스트**:
  - [ ] 3개 OCR 엔진 벤치마크 완료
  - [ ] 최적 OCR 엔진 선정
  - [ ] YOLO + OCR 파이프라인 구현

#### 4.2 엔드투엔드 테스트
- **작업**: `feature/ui-detection-test`
- **테스트 시나리오**:
  - [ ] 실시간 게임플레이에서 재화 정보 추출
  - [ ] 일일 퀘스트 진행도 자동 인식
  - [ ] 콘텐츠 완료 여부 판별
- **성능 목표**:
  - UI 탐지 정확도: 95% 이상
  - OCR 정확도: 90% 이상
  - 전체 처리 시간: 100ms 이내
- **체크리스트**:
  - [ ] 10회 이상 엔드투엔드 테스트 성공
  - [ ] 엣지 케이스 처리 (UI 가림, 애니메이션 등)
  - [ ] 에러 핸들링 로직 구현

---

## 5. 📊 예상 타임라인

| Phase | 기간 | 주요 산출물 | 완료 기준 |
|-------|------|------------|-----------|
| Phase 1 | 1-2주 | 데이터셋 스키마, 샘플링 시스템 | 1,000+ 프레임 추출 완료 |
| Phase 2 | 1주 | Label Studio 환경, 라벨링 데이터 | 1,000+ BBOX 라벨링 |
| Phase 3 | 1-2주 | YOLO 모델, 평가 결과 | mAP@0.5 > 0.85 |
| Phase 4 | 1주 | OCR 통합, 프로토타입 시스템 | 엔드투엔드 테스트 통과 |
| **합계** | **4-6주** | **MVP v1.0** | **실전 사용 가능한 프로토타입** |

---

## 6. 🛠️ 기술 스택

### 개발 환경
- **Python**: 3.11+
- **GPU**: CUDA 11.8+ (NVIDIA)
- **OS**: Windows 10/11 (개발), Ubuntu 22.04 (서버, 향후)

### 핵심 라이브러리
- **YOLO**: `ultralytics` (YOLOv8)
- **OCR**: `pytesseract`, `easyocr`, `paddleocr`
- **비디오 처리**: `opencv-python`, `scikit-image`
- **라벨링**: Label Studio
- **데이터 관리**: `pandas`, `numpy`

### 개발 도구
- **버전 관리**: Git + Git LFS
- **문서화**: Markdown, Jupyter Notebook
- **모델 저장**: ONNX (배포용)

---

## 7. 📝 체크리스트 (전체)

### 데이터 준비
- [ ] 게임별 데이터셋 스키마 정의 완료
- [ ] 3개 이상 해상도별 영상 녹화 완료
- [ ] SSIM 기반 스마트 샘플링 구현
- [ ] 1,000+ 프레임 추출 완료

### 라벨링
- [ ] Label Studio 환경 구축
- [ ] 라벨링 템플릿 설정
- [ ] 1,000+ BBOX 라벨링 완료
- [ ] 데이터셋 train/val/test 분리

### 모델 학습
- [ ] YOLO 학습 환경 구축
- [ ] 1차 학습 완료 (baseline)
- [ ] 2차 학습 완료 (optimized)
- [ ] mAP@0.5 > 0.85 달성

### OCR 통합
- [ ] OCR 엔진 벤치마크 완료
- [ ] YOLO + OCR 파이프라인 구현
- [ ] 전처리/후처리 로직 구현
- [ ] OCR 정확도 90% 이상 달성

### 시스템 완성
- [ ] 엔드투엔드 테스트 통과
- [ ] 성능 최적화 (100ms 이내 처리)
- [ ] 에러 핸들링 구현
- [ ] 문서화 완료

---

## 8. 🚧 리스크 및 대응 방안

| 리스크 | 영향도 | 대응 방안 |
|--------|--------|----------|
| 라벨링 데이터 부족 | 높음 | 데이터 증강(Augmentation) 활용 |
| GPU 메모리 부족 | 중간 | 배치 크기 축소, 모델 경량화 |
| OCR 정확도 낮음 | 높음 | 전처리 강화, 다중 OCR 엔진 앙상블 |
| 실시간 처리 속도 느림 | 중간 | 모델 경량화(YOLO nano), ONNX 변환 |
| 새 해상도 대응 실패 | 중간 | 다양한 해상도 데이터 추가 학습 |

---

**다음 문서**: `mvp-roadmap.md` (상세 일정 및 마일스톤)